<div class="dialog-container">
  <div class="dialog-header">
    <mat-icon class="header-icon">group</mat-icon>
    <div class="header-text">
      <h2>{{ data.team.name }} - Team Members</h2>
      <p>Manage team members and their roles</p>
    </div>
    <button mat-icon-button (click)="closeDialog()" class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div class="dialog-content">
    <!-- Current Members -->
    <app-card title="Current Members" variant="outlined" class="members-section">
      @if (isLoadingMembers()) {
        <div class="loading-container">
          <mat-progress-spinner diameter="40"></mat-progress-spinner>
          <p>Loading team members...</p>
        </div>
      } @else if (currentMembers().length === 0) {
        <div class="empty-state">
          <mat-icon class="empty-icon">group_off</mat-icon>
          <p>No members in this team yet.</p>
        </div>
      } @else {
        <div class="members-list">
          @for (member of currentMembers(); track member.userId) {
            <div class="member-item">
              <div class="member-info">
                <div class="member-name">{{ member.username }}</div>
                <div class="member-email">{{ member.email }}</div>
                @if (member.isTeamAdmin) {
                  <span class="admin-badge">Admin</span>
                }
              </div>
              <div class="member-actions">
                <app-button
                  variant="stroked"
                  size="small"
                  [text]="member.isTeamAdmin ? 'Remove Admin' : 'Make Admin'"
                  [color]="member.isTeamAdmin ? 'warn' : 'primary'"
                  (buttonClick)="toggleMemberAdmin(member)">
                </app-button>
                <app-button
                  variant="stroked"
                  size="small"
                  text="Remove"
                  color="warn"
                  leadingIcon="person_remove"
                  (buttonClick)="removeMember(member)">
                </app-button>
              </div>
            </div>
          }
        </div>
      }
    </app-card>

    <!-- Add New Members -->
    <app-card title="Add New Members" variant="outlined" class="add-members-section">
      <div class="search-section">
        <app-input
          label="Search Users"
          placeholder="Search by name or email..."
          prefixIcon="search"
          [clearable]="true"
          [value]="searchTerm()"
          (input)="onSearchChange($event)">
        </app-input>
      </div>

      @if (isLoadingUsers()) {
        <div class="loading-container">
          <mat-progress-spinner diameter="40"></mat-progress-spinner>
          <p>Loading users...</p>
        </div>
      } @else if (availableUsers().length === 0) {
        <div class="empty-state">
          <mat-icon class="empty-icon">person_search</mat-icon>
          <p>{{ searchTerm() ? 'No users found matching your search.' : 'All users are already team members.' }}</p>
        </div>
      } @else {
        <div class="users-list">
          @for (user of availableUsers(); track user.id) {
            <div class="user-item">
              <div class="user-info">
                <div class="user-name">{{ user.username }}</div>
                <div class="user-email">{{ user.email }}</div>
              </div>
              <div class="user-actions">
                <label class="admin-checkbox">
                  <input type="checkbox" [id]="'admin-' + user.id" [checked]="selectedAdmins().has(user.id)" (change)="toggleUserAdmin(user.id, $event)">
                  <span>Make Admin</span>
                </label>
                <app-button
                  variant="raised"
                  size="small"
                  text="Add to Team"
                  color="primary"
                  leadingIcon="person_add"
                  [loading]="isAddingUser() === user.id"
                  (buttonClick)="addMemberToTeam(user)">
                </app-button>
              </div>
            </div>
          }
        </div>
      }
    </app-card>
  </div>

  <div class="dialog-actions">
    <app-button
      variant="stroked"
      text="Close"
      (buttonClick)="closeDialog()">
    </app-button>
  </div>
</div>